#!/usr/bin/env php
<?php

require __DIR__.'/../vendor/autoload.php';

use Symfony\Component\Console\Application;

$version = file_get_contents(__DIR__.'/../VERSION');
$application = new Application;
$application->setName('minion');
$application->setVersion($version);

// Built-in commands
$commands = [
    new \minion\Commands\MakeInitCommand,
    new \minion\Commands\MakeConfigCommand,
    new \minion\Commands\MakeCommandCommand,
    new \minion\Commands\MakeTaskCommand,

    new \minion\Commands\DeployReleaseCommand,
    new \minion\Commands\DeployUpdateCommand,

    new \minion\Commands\TaskCommand,
];

// Custom commands
if( file_exists('Commands') ){
    $files = new \DirectoryIterator('Commands');

    /** @var \DirectoryIterator[] $files */
    foreach( $files as $file ) {
        if (preg_match('/^(.+)\.php$/i', $file->getFilename(), $match)) {
            $className = "\\minion\\Commands\\{$match[1]}";
            $commands[] = new $className;
        }
    }
}

$application->addCommands($commands);
$application->setCatchExceptions(true);
$application->run();